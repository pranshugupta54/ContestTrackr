<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/dashboardStyles.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
  
    <div class="sticky-top m-0" id="navigation">
        <header class="container d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
            <a href="/"
                class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
                <svg class="bi me-2" width="40" height="32">
                    <!-- <img src="/images/110x110.png" width="100"> -->
                </svg>
                <span class="fs-4" id="brand_name">Digitomize</span>
            </a>

            <ul class="nav nav-pills" style="align-content: center;">
                <li class="nav-item"><a href="/contests" class="nav-link">Contests</a></li>
                <li class="nav-item"><a href="/users" class="nav-link">Users</a></li>
                <li class="nav-item"><a href="#" class="nav-link">FAQs</a></li>
                <li class="nav-item"><a href="#" class="nav-link">About</a></li>
                <li class="nav-item"><a href="#" class="nav-link">Contact</a></li>
            </ul>
        </header>
    </div>
</head>

<body>

    <div class="d-flex flex-row h-100 container-fluid p-0">

        <div class="d-flex flex-column flex-shrink-0 p-3 text-bg-dark" style="width: 280px;">
            <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none">
                <svg class="bi pe-none me-2" width="40" height="32">
                    <use xlink:href="#bootstrap"></use>
                </svg>
                <span class="fs-4">Sidebar</span>
            </a>
            <hr />
            <ul class="nav nav-pills flex-column mb-auto">
                <li class="nav-item">
                    <a href="#" class="nav-link active" aria-current="page">
                        <svg class="bi pe-none me-2" width="16" height="16">
                            <use xlink:href="#home"></use>
                        </svg>
                        Home
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link text-white">
                        <svg class="bi pe-none me-2" width="16" height="16">
                            <use xlink:href="#speedometer2"></use>
                        </svg>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link text-white">
                        <svg class="bi pe-none me-2" width="16" height="16">
                            <use xlink:href="#table"></use>
                        </svg>
                        Orders
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link text-white">
                        <svg class="bi pe-none me-2" width="16" height="16">
                            <use xlink:href="#grid"></use>
                        </svg>
                        Products
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link text-white">
                        <svg class="bi pe-none me-2" width="16" height="16">
                            <use xlink:href="#people-circle"></use>
                        </svg>
                        Customers
                    </a>
                </li>
            </ul>
            <hr />
            <div class="dropdown">
                <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="https://github.com/mdo.png" alt="" width="32" height="32" class="rounded-circle me-2" />
                    <strong>mdo</strong>
                </a>
                <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
                    <li><a class="dropdown-item" href="#">New project...</a></li>
                    <li><a class="dropdown-item" href="#">Settings</a></li>
                    <li><a class="dropdown-item" href="#">Profile</a></li>
                    <li>
                        <hr class="dropdown-divider" />
                    </li>
                    <li><a class="dropdown-item" href="#">Sign out</a></li>
                </ul>
            </div>
        </div>


        <div class="right d-flex flex-column w-100 p-5">
            <div class="top d-flex flex-row justify-content-between">
                <h1>Manage Users</h1>
                <a href="#" style="width: 13%;"><button type="button" class="btn btn-primary"
                        style="width: -webkit-fill-available;">Add User</button></a>
            </div>
            <div class="bottom">

                <div class="table-responsive small">
                    <table class="text-center table table-hover  table-dark table-striped table-sm align-middle">
                        <thead style="font-size: large;">
                            <tr>
                                <div class="row">
                                    <th scope="col">No.</th>
                                    <th scope="col" style="width: 40%;">User Name</th>
                                    <th scope="col col-2">Vanity</th>
                                    <th scope="col col-2">hm</th>
                                    <th scope="col col-2">hm</th>
                                </div>
                            </tr>
                        </thead>
                        <tbody class="table-group-divider">
                            <% for(let i = 0; i < users.length; i++){ %>
                                <% var user = users[i]; %>
                                <% console.log(user); %>
                                <tr>
                                    <td> <%= i+1 %> </td>
                                    <td><%= users[i].username %></td>
                                    <td><%= users[i].vanity %></td>
                                    <td>
                                            <button type="button"
                                                    class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#exampleModal" data-user='<%= JSON.stringify(user)%>'>Edit
                                            </button>
                                    </td>
                                    <td>
                                            <button type="button"
                                                    class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#exampleModal2" data-user='<%=JSON.stringify(users[i])%>'>Deletee
                                            </button>
                                    </td>
                                </tr>
                                <% } %> 
                            <tr>
                                <td>1,001</td>
                                <td>Sample User</td>
                                <td>/pranshu</td>
                                <td><a href="#"><button type="button"
                                            class="m-1 btn btn-sm btn-outline-secondary">Edit</button></a></td>
                                <td><a href="#"><button type="button"
                                            class="btn btn-sm btn-outline-danger">Delete</button></a></td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>

        </div>


    </div>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Details</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="modal-form">
                <div class="mb-3">
                  <label for="username" class="col-form-label">User:</label>
                  <input type="text" class="form-control" id="username" name="username">
                </div>
                <div class="mb-3">
                    <label for="vanity" class="col-form-label">Vanity:</label>
                    <input type="text" class="form-control" id="vanity" name="vanity" readonly>
                </div>
                <div class="mb-3">
                    <label for="codechef" class="col-form-label">Codechef:</label>
                    <input type="text" class="form-control" id="codechef" name="codechef">
                </div>
                <div class="mb-3">
                    <label for="codeforces" class="col-form-label">Codeforces:</label>
                    <input type="text" class="form-control" id="codeforces" name="codeforces">
                </div>
                <div class="mb-3">
                    <label for="leetcode" class="col-form-label">Leetcode:</label>
                    <input type="text" class="form-control" id="leetcode" name="leetcode">
                </div>
                <!-- <div class="mb-3">
                  <label for="message-text" class="col-form-label">Message:</label>
                  <textarea class="form-control" id="message-text"></textarea>
                </div> -->
                <!-- <button type="submit">submit</button> -->
              <!-- </form> -->
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary form="modal-form">Send message</button>
            </div>
        </form>
          </div>
        </div>
      </div>
    <!-- Modal 2 -->
    <div class="modal fade" id="exampleModal2" aria-hidden="true" aria-labelledby="exampleModalLabel2" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalToggleLabel2">Modal 2</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="m2-message">
              Hide this modal and show the first with the button below.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="refreshPage()">Close</button>
            </div>
          </div>
        </div>
    </div>
</body>
<!-- <script>
    document.addEventListener('DOMContentLoaded', function() {
    const button = document.querySelector('[data-bs-target="#exampleModal"]');
    const recipientInput = document.querySelector('#recipient-name');
    const messageInput = document.querySelector('#message-text');

    button.addEventListener('click', function(event) {
        const recipient = button.getAttribute('data-recipient');
        const message = button.getAttribute('data-message');

        recipientInput.value = recipient;
        messageInput.value = message;
    });
    });


</script> -->

<script>
function refreshPage() {
  location.reload();
}

  document.addEventListener('DOMContentLoaded', function() {
    const buttons = document.querySelectorAll('[data-bs-target="#exampleModal"]');
    const usernameInput = document.querySelector('#username');
    const vanityInput = document.querySelector('#vanity');
    const codechefInput = document.querySelector('#codechef');
    const codeforcesInput = document.querySelector('#codeforces');
    const leetcodeInput = document.querySelector('#leetcode');

    buttons.forEach(function(button) {
      button.addEventListener('click', function(event) {
        const userJson = button.getAttribute('data-user');
        console.log(userJson);
        const user = JSON.parse(userJson);
        console.log(user);

        const username = user.username;
        const vanity = user.vanity;
        const cc = user.codechef.username;
        const cf = user.codeforces.username;
        const lc = user.leetcode.username;

        usernameInput.value = username;
        vanityInput.value = vanity;
        codechefInput.value = cc;
        codeforcesInput.value = cf;
        leetcodeInput.value = lc;
      });
    });
  });


document.addEventListener('DOMContentLoaded', function() {
  // Get the modal element
  const modal = document.getElementById('exampleModal');
  const modalMessage = document.getElementById('m2-message');

//   Function to close the modal
  function closeModal() {
    const modalInstance = bootstrap.Modal.getInstance(modal);
    modalInstance.hide();
  }

  // Attach event listener to the form submission
  const form = document.getElementById('modal-form');
  form.addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent default form submission
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);
    console.log("DATA");
    console.log(formData);
    console.log(data);

    // Make the POST request to your backend
    fetch('/users/edit', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    })
    .then(response => {
      if (response.ok) {
        // Form submission successful, close the modal
        // const firstModal = document.getElementById('exampleModal');
        const secondModal = new bootstrap.Modal(document.getElementById('exampleModal2'));
        // firstModal.hide();
        closeModal();
        secondModal.show();
        modalMessage.textContent = 'Form submitted successfully.';
      } else {
        const secondModal = new bootstrap.Modal(document.getElementById('exampleModal2'));
        closeModal();
        secondModal.show();
        modalMessage.textContent = 'Error Submitting Form';
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
  });
});






</script>


</html>